<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cash Runway Worksheet</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;
    
    // ‚ö†Ô∏è IMPORTANT: Replace this with your Apps Script URL
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwxB8Y_a3d50DRclddd58oWmzBWh7rrFIa_cylTY6OjmkciZ8j0bYpNrXeNjyVEDYdl/exec';
    
    // Lucide React icons (inline)
    const Download = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );
    
    const Plus = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    
    const Trash2 = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );
    
    const AlertCircle = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
    );
    
    const TrendingUp = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );
    
    const DollarSign = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <line x1="12" y1="1" x2="12" y2="23"></line>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
      </svg>
    );
    
    const FileText = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
    );
    
    const Cloud = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
      </svg>
    );
    
    const RefreshCw = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
      </svg>
    );
    
    const ExternalLink = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
        <polyline points="15 3 21 3 21 9"></polyline>
        <line x1="10" y1="14" x2="21" y2="3"></line>
      </svg>
    );

    const NewsFinancialWorksheet = () => {
      const [orgName, setOrgName] = useState('');
      const [currentMonthlyRevenue, setCurrentMonthlyRevenue] = useState('');
      const [currentMonthlyExpenses, setCurrentMonthlyExpenses] = useState('');
      const [cashReserves, setCashReserves] = useState('');
      const [timeHorizon, setTimeHorizon] = useState('6');
      const [showRestoreMessage, setShowRestoreMessage] = useState(false);
      const [googleSheetId, setGoogleSheetId] = useState('');
      const [syncStatus, setSyncStatus] = useState('');
      const [isSyncing, setIsSyncing] = useState(false);

      const [revenueStreams, setRevenueStreams] = useState([
        { name: '', current: '', target: '', timeline: '3' },
        { name: '', current: '', target: '', timeline: '3' },
        { name: '', current: '', target: '', timeline: '3' },
        { name: '', current: '', target: '', timeline: '3' }
      ]);

      const [costCutting, setCostCutting] = useState([
        { item: '', monthlySavings: '', impact: 'low', timeline: '1' }
      ]);

      const [newInitiatives, setNewInitiatives] = useState([
        { initiative: '', estimatedRevenue: '', cost: '', timeline: '3' }
      ]);

      // Load saved data on mount
      React.useEffect(() => {
        const savedData = localStorage.getItem('cashRunwayWorksheet');
        if (savedData) {
          try {
            const parsed = JSON.parse(savedData);
            setOrgName(parsed.orgName || '');
            setCurrentMonthlyRevenue(parsed.currentMonthlyRevenue || '');
            setCurrentMonthlyExpenses(parsed.currentMonthlyExpenses || '');
            setCashReserves(parsed.cashReserves || '');
            setTimeHorizon(parsed.timeHorizon || '6');
            setRevenueStreams(parsed.revenueStreams || revenueStreams);
            setCostCutting(parsed.costCutting || costCutting);
            setNewInitiatives(parsed.newInitiatives || newInitiatives);
            setGoogleSheetId(parsed.googleSheetId || '');
            setShowRestoreMessage(true);
            setTimeout(() => setShowRestoreMessage(false), 5000);
          } catch (e) {
            console.error('Error loading saved data:', e);
          }
        }
      }, []);

      // Auto-save whenever data changes
      React.useEffect(() => {
        const dataToSave = {
          orgName,
          currentMonthlyRevenue,
          currentMonthlyExpenses,
          cashReserves,
          timeHorizon,
          revenueStreams,
          costCutting,
          newInitiatives,
          googleSheetId
        };
        localStorage.setItem('cashRunwayWorksheet', JSON.stringify(dataToSave));
        
        // Auto-sync to Google Sheets if connected
        if (googleSheetId && APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL_HERE') {
          syncToGoogleSheets(true); // silent sync
        }
      }, [orgName, currentMonthlyRevenue, currentMonthlyExpenses, cashReserves, timeHorizon, revenueStreams, costCutting, newInitiatives]);

      const clearAllData = () => {
        if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
          localStorage.removeItem('cashRunwayWorksheet');
          setOrgName('');
          setCurrentMonthlyRevenue('');
          setCurrentMonthlyExpenses('');
          setCashReserves('');
          setTimeHorizon('6');
          setGoogleSheetId('');
          setRevenueStreams([
            { name: '', current: '', target: '', timeline: '3' },
            { name: '', current: '', target: '', timeline: '3' },
            { name: '', current: '', target: '', timeline: '3' },
            { name: '', current: '', target: '', timeline: '3' }
          ]);
          setCostCutting([{ item: '', monthlySavings: '', impact: 'low', timeline: '1' }]);
          setNewInitiatives([{ initiative: '', estimatedRevenue: '', cost: '', timeline: '3' }]);
          setSyncStatus('');
        }
      };

      const createNewGoogleSheet = async () => {
        if (APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL_HERE') {
          alert('Apps Script not configured. Please add your Apps Script URL to the HTML file.');
          return;
        }
        
        setIsSyncing(true);
        setSyncStatus('Creating new Google Sheet...');
        
        try {
          const response = await fetch(`${APPS_SCRIPT_URL}?action=create&orgName=${encodeURIComponent(orgName || 'Unnamed Organization')}`);
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success) {
            setGoogleSheetId(data.sheetId);
            setSyncStatus('‚úì Google Sheet created! Syncing initial data...');
            
            // Now sync the current data to the sheet
            await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second for sheet to be ready
            await syncToGoogleSheets(true);
            
            setSyncStatus(`‚úì Connected to Google Sheets! Click "Open Sheet" to view.`);
            setTimeout(() => setSyncStatus(''), 5000);
          } else {
            setSyncStatus('‚úó Error creating sheet: ' + (data.error || 'Unknown error'));
            console.error('Sheet creation error:', data);
          }
        } catch (error) {
          setSyncStatus('‚úó Error: ' + error.message);
          console.error('Network error:', error);
        }
        
        setIsSyncing(false);
      };

      const connectExistingSheet = () => {
        const sheetInput = prompt('Enter your Google Sheet ID or URL:\n\n(You can find the ID in the Sheet URL between /d/ and /edit)');
        if (sheetInput) {
          // Extract sheet ID from URL if full URL was provided
          let sheetId = sheetInput;
          const match = sheetInput.match(/\/d\/([a-zA-Z0-9-_]+)/);
          if (match) {
            sheetId = match[1];
          }
          
          setGoogleSheetId(sheetId);
          setSyncStatus('‚úì Connected to existing sheet');
          setTimeout(() => setSyncStatus(''), 3000);
          
          // Optionally load data from the sheet
          if (confirm('Would you like to load data from this sheet?')) {
            syncFromGoogleSheets();
          }
        }
      };

      const syncToGoogleSheets = async (silent = false) => {
        if (!googleSheetId) {
          if (!silent) alert('No Google Sheet connected. Please create or connect a sheet first.');
          return;
        }
        
        if (APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL_HERE') {
          if (!silent) alert('Please configure your Apps Script URL in the HTML file first.');
          return;
        }
        
        if (!silent) {
          setIsSyncing(true);
          setSyncStatus('Syncing to Google Sheets...');
        }
        
        try {
          const payload = {
            sheetId: googleSheetId,
            orgName,
            currentMonthlyRevenue,
            currentMonthlyExpenses,
            cashReserves,
            timeHorizon,
            revenueStreams,
            costCutting,
            newInitiatives
          };
          
          // Use GET with data in URL parameters (better CORS support)
          const params = new URLSearchParams({
            action: 'save',
            sheetId: googleSheetId,
            data: JSON.stringify(payload)
          });
          
          const response = await fetch(`${APPS_SCRIPT_URL}?${params.toString()}`);
          const data = await response.json();
          
          if (data.success) {
            if (!silent) {
              setSyncStatus('‚úì Synced to Google Sheets');
              setTimeout(() => setSyncStatus(''), 3000);
            }
          } else {
            if (!silent) setSyncStatus('‚úó Sync error: ' + (data.error || 'Unknown error'));
          }
        } catch (error) {
          console.error('Sync error:', error);
          if (!silent) setSyncStatus('‚úó Sync error: ' + error.message);
        }
        
        if (!silent) setIsSyncing(false);
      };

      const syncFromGoogleSheets = async () => {
        if (!googleSheetId) {
          alert('No Google Sheet connected.');
          return;
        }
        
        if (APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL_HERE') {
          alert('Please configure your Apps Script URL in the HTML file first.');
          return;
        }
        
        setIsSyncing(true);
        setSyncStatus('Loading from Google Sheets...');
        
        try {
          const response = await fetch(`${APPS_SCRIPT_URL}?action=load&sheetId=${googleSheetId}`);
          const result = await response.json();
          
          if (result.success && result.data) {
            const data = result.data;
            setOrgName(data.orgName || '');
            setCurrentMonthlyRevenue(data.currentMonthlyRevenue || '');
            setCurrentMonthlyExpenses(data.currentMonthlyExpenses || '');
            setCashReserves(data.cashReserves || '');
            setTimeHorizon(data.timeHorizon || '6');
            setRevenueStreams(data.revenueStreams || revenueStreams);
            setCostCutting(data.costCutting || costCutting);
            setNewInitiatives(data.newInitiatives || newInitiatives);
            
            setSyncStatus('‚úì Loaded from Google Sheets');
            setTimeout(() => setSyncStatus(''), 3000);
          } else {
            setSyncStatus('‚úó Load error: ' + (result.error || 'Unknown error'));
          }
        } catch (error) {
          setSyncStatus('‚úó Load error: ' + error.message);
        }
        
        setIsSyncing(false);
      };

      const openGoogleSheet = () => {
        if (!googleSheetId) {
          alert('No Google Sheet connected.');
          return;
        }
        window.open(`https://docs.google.com/spreadsheets/d/${googleSheetId}/edit`, '_blank');
      };

      const addRevenueStream = () => {
        setRevenueStreams([...revenueStreams, { name: '', current: '', target: '', timeline: '3' }]);
      };

      const removeRevenueStream = (index) => {
        setRevenueStreams(revenueStreams.filter((_, i) => i !== index));
      };

      const updateRevenueStream = (index, field, value) => {
        const updated = [...revenueStreams];
        updated[index][field] = value;
        setRevenueStreams(updated);
      };

      const addCostCut = () => {
        setCostCutting([...costCutting, { item: '', monthlySavings: '', impact: 'low', timeline: '1' }]);
      };

      const removeCostCut = (index) => {
        setCostCutting(costCutting.filter((_, i) => i !== index));
      };

      const updateCostCut = (index, field, value) => {
        const updated = [...costCutting];
        updated[index][field] = value;
        setCostCutting(updated);
      };

      const addInitiative = () => {
        setNewInitiatives([...newInitiatives, { initiative: '', estimatedRevenue: '', cost: '', timeline: '3' }]);
      };

      const removeInitiative = (index) => {
        setNewInitiatives(newInitiatives.filter((_, i) => i !== index));
      };

      const updateInitiative = (index, field, value) => {
        const updated = [...newInitiatives];
        updated[index][field] = value;
        setNewInitiatives(updated);
      };

      const calculateMetrics = () => {
        const revenue = parseFloat(currentMonthlyRevenue) || 0;
        const expenses = parseFloat(currentMonthlyExpenses) || 0;
        const reserves = parseFloat(cashReserves) || 0;
        const monthlyDeficit = expenses - revenue;
        const runwayMonths = monthlyDeficit > 0 ? (reserves / monthlyDeficit) : Infinity;

        const totalCostSavings = costCutting.reduce((sum, cut) => 
          sum + (parseFloat(cut.monthlySavings) || 0), 0);
        
        const totalNewRevenue = revenueStreams.reduce((sum, stream) => 
          sum + ((parseFloat(stream.target) || 0) - (parseFloat(stream.current) || 0)), 0);
        
        const initiativeNetRevenue = newInitiatives.reduce((sum, init) => 
          sum + ((parseFloat(init.estimatedRevenue) || 0) - (parseFloat(init.cost) || 0)), 0);

        const projectedMonthlyNet = revenue + totalNewRevenue + initiativeNetRevenue - (expenses - totalCostSavings);
        const breakevenGap = projectedMonthlyNet >= 0 ? 0 : Math.abs(projectedMonthlyNet);

        return {
          monthlyDeficit,
          runwayMonths,
          totalCostSavings,
          totalNewRevenue,
          initiativeNetRevenue,
          projectedMonthlyNet,
          breakevenGap
        };
      };

      const metrics = calculateMetrics();

      const formatCurrency = (value) => {
        if (value === Infinity) return '‚àû';
        return new Intl.NumberFormat('en-US', { 
          style: 'currency', 
          currency: 'USD',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        }).format(value);
      };

      const exportToCSV = () => {
        let csv = `90-Day Cash Runway Worksheet\n`;
        csv += `Organization,${orgName}\n`;
        csv += `Current Monthly Revenue,${currentMonthlyRevenue}\n`;
        csv += `Current Monthly Expenses,${currentMonthlyExpenses}\n`;
        csv += `Cash Reserves,${cashReserves}\n`;
        csv += `Planning Horizon (months),${timeHorizon}\n\n`;
        
        csv += `Revenue Streams\n`;
        csv += `Name,Current Monthly,Target Monthly,Timeline (months)\n`;
        revenueStreams.forEach(stream => {
          csv += `${stream.name},${stream.current},${stream.target},${stream.timeline}\n`;
        });
        
        csv += `\nCost Cutting Measures\n`;
        csv += `Item,Monthly Savings,Impact on Mission,Timeline (months)\n`;
        costCutting.forEach(cut => {
          csv += `${cut.item},${cut.monthlySavings},${cut.impact},${cut.timeline}\n`;
        });
        
        csv += `\nNew Initiatives\n`;
        csv += `Initiative,Est. Monthly Revenue,Monthly Cost,Timeline (months)\n`;
        newInitiatives.forEach(init => {
          csv += `${init.initiative},${init.estimatedRevenue},${init.cost},${init.timeline}\n`;
        });

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${orgName.replace(/\s+/g, '_')}_financial_plan.csv`;
        a.click();
      };

      const printPDF = () => {
        window.print();
      };

      return (
        <div className="min-h-screen bg-gray-50 p-6">
          <style>{`
            @media print {
              body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
              .no-print { display: none !important; }
              .min-h-screen { min-height: auto; }
              @page { margin: 0.5in; }
            }
          `}</style>
          <div className="max-w-6xl mx-auto">
          
          {/* Google Sheets Connection Bar */}
          <div className="bg-white rounded-lg shadow-lg p-4 mb-4 no-print">
            <div className="flex flex-wrap items-center justify-between gap-3">
              <div className="flex items-center gap-3">
                <Cloud className="text-blue-600" size={24} />
                <div>
                  <div className="font-semibold text-gray-900">Google Sheets Collaboration</div>
                  <div className="text-sm text-gray-600">
                    {googleSheetId ? (
                      <span className="text-green-600">‚úì Connected to Sheet</span>
                    ) : (
                      <span>Create or connect a Google Sheet for team collaboration</span>
                    )}
                  </div>
                </div>
              </div>
              
              <div className="flex flex-wrap gap-2">
                {!googleSheetId ? (
                  <>
                    <button
                      onClick={createNewGoogleSheet}
                      disabled={isSyncing}
                      className="flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm disabled:opacity-50"
                    >
                      <Plus size={16} />
                      Create New Sheet
                    </button>
                    <button
                      onClick={connectExistingSheet}
                      className="flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm"
                    >
                      <Cloud size={16} />
                      Connect Existing
                    </button>
                  </>
                ) : (
                  <>
                    <button
                      onClick={() => syncToGoogleSheets(false)}
                      disabled={isSyncing}
                      className="flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm disabled:opacity-50"
                    >
                      <RefreshCw size={16} />
                      Sync to Sheet
                    </button>
                    <button
                      onClick={syncFromGoogleSheets}
                      disabled={isSyncing}
                      className="flex items-center gap-2 px-3 py-1.5 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm disabled:opacity-50"
                    >
                      <Download size={16} />
                      Load from Sheet
                    </button>
                    <button
                      onClick={openGoogleSheet}
                      className="flex items-center gap-2 px-3 py-1.5 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors text-sm"
                    >
                      <ExternalLink size={16} />
                      Open Sheet
                    </button>
                  </>
                )}
              </div>
            </div>
            {syncStatus && (
              <div className="mt-2 text-sm text-gray-700">
                {syncStatus}
              </div>
            )}
          </div>
          
          <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
          <div className="flex justify-between items-start mb-6">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 mb-2">
                Cash Runway Worksheet
              </h1>
              <p className="text-gray-600">Strategic planning for short-term financial sustainability</p>
              {showRestoreMessage && (
                <div className="mt-2 text-sm text-green-600 font-medium">
                  ‚úì Data restored from your last session
                </div>
              )}
            </div>
            <div className="flex gap-2 no-print">
              <button
                onClick={clearAllData}
                className="flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                title="Clear all data and start fresh"
              >
                Clear All
              </button>
              <button
                onClick={printPDF}
                className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
              >
                <FileText size={18} />
                Save as PDF
              </button>
              <button
                onClick={exportToCSV}
                className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
              >
                <Download size={18} />
                Export CSV
              </button>
            </div>
          </div>

          {/* Basic Information */}
          <div className="border-b pb-6 mb-6">
            <h2 className="text-xl font-semibold mb-4">Organization Information</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Organization Name
                </label>
                <input
                  type="text"
                  value={orgName}
                  onChange={(e) => setOrgName(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="Enter organization name"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Planning Horizon (months)
                </label>
                <input
                  type="number"
                  value={timeHorizon}
                  onChange={(e) => setTimeHorizon(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  min="1"
                  max="24"
                />
              </div>
            </div>
          </div>

          {/* Current Financial Snapshot */}
          <div className="border-b pb-6 mb-6">
            <h2 className="text-xl font-semibold mb-4">Current Financial Snapshot</h2>
            <p className="text-sm text-gray-600 mb-4">
              <strong>üí° Tip for variable revenue:</strong> If your monthly revenue fluctuates significantly, use an average of the last 3-6 months. 
              For seasonal organizations, consider using your typical "low season" revenue as a conservative estimate.
            </p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Current Monthly Revenue
                </label>
                <div className="relative">
                  <span className="absolute left-3 top-2 text-gray-500">$</span>
                  <input
                    type="number"
                    value={currentMonthlyRevenue}
                    onChange={(e) => setCurrentMonthlyRevenue(e.target.value)}
                    className="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="0"
                  />
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Current Monthly Expenses
                </label>
                <div className="relative">
                  <span className="absolute left-3 top-2 text-gray-500">$</span>
                  <input
                    type="number"
                    value={currentMonthlyExpenses}
                    onChange={(e) => setCurrentMonthlyExpenses(e.target.value)}
                    className="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="0"
                  />
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Cash Reserves
                </label>
                <div className="relative">
                  <span className="absolute left-3 top-2 text-gray-500">$</span>
                  <input
                    type="number"
                    value={cashReserves}
                    onChange={(e) => setCashReserves(e.target.value)}
                    className="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>

          {/* Key Metrics Dashboard */}
          <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6 mb-6">
            <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
              <TrendingUp className="text-blue-600" />
              Key Metrics
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div className="bg-white rounded-lg p-4 shadow-sm">
                <div className="text-sm text-gray-600 mb-1">Current Monthly Deficit</div>
                <div className={`text-2xl font-bold ${metrics.monthlyDeficit > 0 ? 'text-red-600' : 'text-green-600'}`}>
                  {formatCurrency(Math.abs(metrics.monthlyDeficit))}
                </div>
              </div>
              <div className="bg-white rounded-lg p-4 shadow-sm">
                <div className="text-sm text-gray-600 mb-1">Runway (months)</div>
                <div className={`text-2xl font-bold ${metrics.runwayMonths < 6 ? 'text-red-600' : metrics.runwayMonths < 12 ? 'text-yellow-600' : 'text-green-600'}`}>
                  {metrics.runwayMonths === Infinity ? '‚àû' : metrics.runwayMonths.toFixed(1)}
                </div>
              </div>
              <div className="bg-white rounded-lg p-4 shadow-sm">
                <div className="text-sm text-gray-600 mb-1">Projected Net Change</div>
                <div className={`text-2xl font-bold ${metrics.projectedMonthlyNet >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                  {formatCurrency(metrics.projectedMonthlyNet)}
                </div>
              </div>
              <div className="bg-white rounded-lg p-4 shadow-sm">
                <div className="text-sm text-gray-600 mb-1">Gap to Break-even</div>
                <div className={`text-2xl font-bold ${metrics.breakevenGap === 0 ? 'text-green-600' : 'text-orange-600'}`}>
                  {formatCurrency(metrics.breakevenGap)}
                </div>
              </div>
            </div>
            {metrics.runwayMonths < 6 && metrics.runwayMonths !== Infinity && (
              <div className="mt-4 bg-red-100 border border-red-300 rounded-lg p-3 flex items-start gap-2">
                <AlertCircle className="text-red-600 mt-0.5 flex-shrink-0" size={20} />
                <div className="text-sm text-red-800">
                  <strong>Critical:</strong> Less than 6 months runway. Immediate action required.
                </div>
              </div>
            )}
          </div>

          {/* Revenue Streams */}
          <div className="border-b pb-6 mb-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-semibold">Revenue Streams</h2>
              <button
                onClick={addRevenueStream}
                className="no-print flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm"
              >
                <Plus size={16} />
                Add Stream
              </button>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Revenue Source</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Current ($/mo)</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Target ($/mo)</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Timeline (mo)</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Increase</th>
                    <th className="px-4 py-2"></th>
                  </tr>
                </thead>
                <tbody>
                  {revenueStreams.map((stream, index) => {
                    const increase = (parseFloat(stream.target) || 0) - (parseFloat(stream.current) || 0);
                    return (
                      <tr key={index} className="border-b">
                        <td className="px-4 py-2">
                          <input
                            type="text"
                            value={stream.name}
                            onChange={(e) => updateRevenueStream(index, 'name', e.target.value)}
                            className="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="Source name"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <input
                            type="number"
                            value={stream.current}
                            onChange={(e) => updateRevenueStream(index, 'current', e.target.value)}
                            className="w-24 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="0"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <input
                            type="number"
                            value={stream.target}
                            onChange={(e) => updateRevenueStream(index, 'target', e.target.value)}
                            className="w-24 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="0"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <input
                            type="number"
                            value={stream.timeline}
                            onChange={(e) => updateRevenueStream(index, 'timeline', e.target.value)}
                            className="w-20 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="3"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <span className={`font-semibold ${increase >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                            {formatCurrency(increase)}
                          </span>
                        </td>
                        <td className="px-4 py-2">
                          <button
                            onClick={() => removeRevenueStream(index)}
                            className="no-print text-red-600 hover:text-red-800"
                          >
                            <Trash2 size={16} />
                          </button>
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
            <div className="mt-4 bg-green-50 rounded-lg p-4">
              <div className="text-sm font-medium text-gray-700">Total Revenue Increase:</div>
              <div className="text-2xl font-bold text-green-600">{formatCurrency(metrics.totalNewRevenue)}</div>
            </div>
          </div>

          {/* Cost Cutting */}
          <div className="border-b pb-6 mb-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-semibold">Cost Cutting Measures</h2>
              <button
                onClick={addCostCut}
                className="no-print flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm"
              >
                <Plus size={16} />
                Add Measure
              </button>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Item/Action</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Monthly Savings</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Impact on Mission</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Timeline (mo)</th>
                    <th className="px-4 py-2"></th>
                  </tr>
                </thead>
                <tbody>
                  {costCutting.map((cut, index) => (
                    <tr key={index} className="border-b">
                      <td className="px-4 py-2">
                        <input
                          type="text"
                          value={cut.item}
                          onChange={(e) => updateCostCut(index, 'item', e.target.value)}
                          className="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                          placeholder="Description"
                        />
                      </td>
                      <td className="px-4 py-2">
                        <input
                          type="number"
                          value={cut.monthlySavings}
                          onChange={(e) => updateCostCut(index, 'monthlySavings', e.target.value)}
                          className="w-24 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                          placeholder="0"
                        />
                      </td>
                      <td className="px-4 py-2">
                        <select
                          value={cut.impact}
                          onChange={(e) => updateCostCut(index, 'impact', e.target.value)}
                          className="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                        >
                          <option value="low">Low</option>
                          <option value="medium">Medium</option>
                          <option value="high">High</option>
                        </select>
                      </td>
                      <td className="px-4 py-2">
                        <input
                          type="number"
                          value={cut.timeline}
                          onChange={(e) => updateCostCut(index, 'timeline', e.target.value)}
                          className="w-20 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                          placeholder="1"
                        />
                      </td>
                      <td className="px-4 py-2">
                        <button
                          onClick={() => removeCostCut(index)}
                          className="no-print text-red-600 hover:text-red-800"
                        >
                          <Trash2 size={16} />
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div className="mt-4 bg-blue-50 rounded-lg p-4">
              <div className="text-sm font-medium text-gray-700">Total Monthly Savings:</div>
              <div className="text-2xl font-bold text-blue-600">{formatCurrency(metrics.totalCostSavings)}</div>
            </div>
          </div>

          {/* New Initiatives */}
          <div className="pb-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-semibold">New Revenue Initiatives</h2>
              <button
                onClick={addInitiative}
                className="no-print flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm"
              >
                <Plus size={16} />
                Add Initiative
              </button>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Initiative</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Est. Revenue ($/mo)</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Cost ($/mo)</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Timeline (mo)</th>
                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Net Impact</th>
                    <th className="px-4 py-2"></th>
                  </tr>
                </thead>
                <tbody>
                  {newInitiatives.map((init, index) => {
                    const netImpact = (parseFloat(init.estimatedRevenue) || 0) - (parseFloat(init.cost) || 0);
                    return (
                      <tr key={index} className="border-b">
                        <td className="px-4 py-2">
                          <input
                            type="text"
                            value={init.initiative}
                            onChange={(e) => updateInitiative(index, 'initiative', e.target.value)}
                            className="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="Initiative name"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <input
                            type="number"
                            value={init.estimatedRevenue}
                            onChange={(e) => updateInitiative(index, 'estimatedRevenue', e.target.value)}
                            className="w-24 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="0"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <input
                            type="number"
                            value={init.cost}
                            onChange={(e) => updateInitiative(index, 'cost', e.target.value)}
                            className="w-24 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="0"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <input
                            type="number"
                            value={init.timeline}
                            onChange={(e) => updateInitiative(index, 'timeline', e.target.value)}
                            className="w-20 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                            placeholder="3"
                          />
                        </td>
                        <td className="px-4 py-2">
                          <span className={`font-semibold ${netImpact >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                            {formatCurrency(netImpact)}
                          </span>
                        </td>
                        <td className="px-4 py-2">
                          <button
                            onClick={() => removeInitiative(index)}
                            className="no-print text-red-600 hover:text-red-800"
                          >
                            <Trash2 size={16} />
                          </button>
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
            <div className="mt-4 bg-purple-50 rounded-lg p-4">
              <div className="text-sm font-medium text-gray-700">Net Impact from Initiatives:</div>
              <div className={`text-2xl font-bold ${metrics.initiativeNetRevenue >= 0 ? 'text-purple-600' : 'text-red-600'}`}>
                {formatCurrency(metrics.initiativeNetRevenue)}
              </div>
            </div>
          </div>
        </div>

        {/* Action Summary */}
        <div className="bg-gradient-to-br from-indigo-600 to-blue-600 rounded-lg shadow-lg p-8 text-white">
          <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
            <DollarSign />
            Action Plan Summary
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 className="font-semibold mb-2 text-lg">Current Situation</h3>
              <div className="space-y-1 text-blue-100">
                <div>Monthly Revenue: {formatCurrency(parseFloat(currentMonthlyRevenue) || 0)}</div>
                <div>Monthly Expenses: {formatCurrency(parseFloat(currentMonthlyExpenses) || 0)}</div>
                <div>Monthly Deficit: {formatCurrency(Math.abs(metrics.monthlyDeficit))}</div>
                <div>Runway: {metrics.runwayMonths === Infinity ? 'Sustainable' : `${metrics.runwayMonths.toFixed(1)} months`}</div>
              </div>
            </div>
            <div>
              <h3 className="font-semibold mb-2 text-lg">Projected Changes</h3>
              <div className="space-y-1 text-blue-100">
                <div>Revenue Increases: +{formatCurrency(metrics.totalNewRevenue)}</div>
                <div>Cost Savings: +{formatCurrency(metrics.totalCostSavings)}</div>
                <div>New Initiatives (net): +{formatCurrency(metrics.initiativeNetRevenue)}</div>
                <div className="pt-2 border-t border-blue-400 font-bold text-white">
                  Projected Monthly Net: {formatCurrency(metrics.projectedMonthlyNet)}
                </div>
              </div>
            </div>
          </div>
          {metrics.breakevenGap > 0 && (
            <div className="mt-6 bg-white bg-opacity-20 rounded-lg p-4">
              <div className="flex items-start gap-3">
                <AlertCircle size={24} className="flex-shrink-0 mt-0.5" />
                <div>
                  <div className="font-semibold text-lg mb-1">Still need to close the gap</div>
                  <div className="text-blue-100">
                    Additional {formatCurrency(metrics.breakevenGap)} per month needed to reach break-even. 
                    Consider additional revenue strategies or further cost reductions.
                  </div>
                </div>
              </div>
            </div>
          )}
          {metrics.projectedMonthlyNet >= 0 && (
            <div className="mt-6 bg-white bg-opacity-20 rounded-lg p-4">
              <div className="flex items-start gap-3">
                <TrendingUp size={24} className="flex-shrink-0 mt-0.5" />
                <div>
                  <div className="font-semibold text-lg mb-1">On track to sustainability!</div>
                  <div className="text-blue-100">
                    If executed as planned, these changes will result in a positive monthly cash flow of {formatCurrency(metrics.projectedMonthlyNet)}.
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Notes Section */}
        <div className="bg-white rounded-lg shadow-lg p-8 mt-6">
          <h2 className="text-xl font-semibold mb-4">Next Steps & Notes</h2>
          <textarea
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-32"
            placeholder="Use this space to capture key decisions, action items, timeline priorities, and any other notes from your office hours session..."
          />
        </div>

        <div className="text-center text-gray-500 text-sm mt-6">
          Cash Runway Worksheet for local news organizations
          <div className="mt-1 text-xs">
            üíæ Your progress is automatically saved in this browser
            {googleSheetId && ' ‚Ä¢ ‚òÅÔ∏è Synced with Google Sheets'}
          </div>
        </div>
      </div>
    </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<NewsFinancialWorksheet />);
  </script>
</body>
</html>
